<% /* Vista: Editar Publicación */ %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<style>
  body {
    background-image: url('/images/fondo_verde.png');
    background-size: cover;
    background-repeat: no-repeat;
    background-attachment: fixed;
  }

  .form-panel-admin {
    background-color: rgba(255, 255, 255, 0.92);
    border-radius: 10px;
    padding: 40px;
    box-shadow: 0 0 15px rgba(0,0,0,0.15);
    max-width: 800px;
    margin: 50px auto;
  }

 .btn-comando {
  background-color: #6dbf3f;
  border: none;
  color: white;
  font-weight: bold;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.btn-comando:hover {
  background-color: #5aa32e;
  transform: scale(1.05);
}


  .form-control, .form-select {
    background-color: #f4fff0;
    border: 1px solid #c0e6ab;
    color: #2b2b2b;
  }

  .form-control:focus, .form-select:focus {
    border-color: #a3d977;
    box-shadow: 0 0 0 0.2rem rgba(163, 217, 119, 0.4);
  }

  .form-label {
    font-weight: bold;
  }

  h2 {
    text-align: center;
    color: #004d40;
    margin-bottom: 30px;
    font-weight: bold;
  }
</style>


<div class="form-panel-admin">
  <h2>Editar Publicación</h2>
 <form id="form-editar" action="/admin/editar/<%= publicacion.id %>" method="POST" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="titulo" class="form-label">Título</label>
      <input type="text" name="titulo" class="form-control" id="titulo" value="<%= publicacion.titulo %>" required>
    </div>

    <div class="mb-3">
      <label for="descripcion" class="form-label">Descripción</label>
      <textarea name="descripcion" class="form-control" id="descripcion" rows="4" required><%= publicacion.descripcion %></textarea>
    </div>

    <div class="mb-3">
      <label for="categoria" class="form-label">Categoría</label>
      <select name="categoria" class="form-select" id="categoria" required>
       <option value="proyeccion-social" <%= publicacion.categoria === 'proyeccion-social' ? 'selected' : '' %>>Proyección Social</option>
      <option value="gestion-riesgo" <%= publicacion.categoria === 'gestion-riesgo' ? 'selected' : '' %>>Gestión de Riesgo en Apoyo a Desastres Naturales</option>
      <option value="actos-civicos" <%= publicacion.categoria === 'actos-civicos' ? 'selected' : '' %>>Actos Cívicos</option>
      <option value="medio-ambiente" <%= publicacion.categoria === 'medio-ambiente' ? 'selected' : '' %>>Mejoramiento del Medio Ambiente</option>

      </select>
    </div>

    <div class="mb-3">
      <label for="fecha_actividad" class="form-label">Fecha de la Actividad</label>
      <input 
        type="date" 
        name="fecha_actividad" 
        id="fecha_actividad" 
        class="form-control" 
        value="<%= publicacion.fecha_actividad ? new Date(publicacion.fecha_actividad).toISOString().split('T')[0] : '' %>" 
        required>
    </div>

    <div class="mb-3">
      <label for="imagenes" class="form-label">Nuevas Imágenes (opcional)</label>
      <input type="file" name="imagenes" id="imagenes" class="form-control" accept="image/*" multiple>
    </div>

    <% if (publicacion.imagenes && publicacion.imagenes.length > 0) { %>
      <div class="mb-3">
        <label class="form-label">Imágenes actuales:</label>
        <div class="d-flex flex-wrap gap-2">
          <% publicacion.imagenes.forEach(img => { %>
            <img src="<%= img %>" style="max-width: 150px;" class="rounded shadow-sm">
          <% }) %>
        </div>
      </div>
    <% } %>

    <div class="d-flex justify-content-between">
  <button type="submit" class="btn btn-comando px-4">Guardar Cambios</button>
  <a href="/admin/publicar" class="btn btn-secondary px-4">Cancelar</a>
</div>
  </form>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  const formEditar = document.getElementById('form-editar');

  formEditar.addEventListener('submit', function (e) {
    e.preventDefault(); // Evita envío inmediato

    Swal.fire({
      icon: 'success',
      title: '¡Se han guardado los cambios!',
      showConfirmButton: false,
      timer: 1600,
      timerProgressBar: true,
      didClose: () => {
        formEditar.submit(); // Ahora sí se envía el formulario
      }
    });
  });
</script>

