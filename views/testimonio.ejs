<% /* views/testimonio.ejs */ %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  body {
    background-image: url('/images/fondo_verde.png');
    background-size: cover;
    background-attachment: fixed;
    font-family: Arial, sans-serif;
  }

  .form-panel {
    background: rgba(255, 255, 255, 0.97);
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.15);
    max-width: 950px;
    margin: 40px auto;
  }

  /* ðŸ”µ Tarjetas en azul-celeste degradado */
  .testimonio-card {
    background: linear-gradient(135deg, #2196f3, #00bcd4); /* Azul â†’ Celeste */
    border-radius: 20px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    transition: all 0.3s ease-in-out;
    height: 100%;
    color: #fff;
    position: relative;
    overflow: hidden;
  }

  /* Hover con mÃ¡s intensidad */
  .testimonio-card:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px 10px rgba(33, 150, 243, 0.4);
    background: linear-gradient(135deg, #42a5f5, #26c6da); /* Azul mÃ¡s claro */
  }

  .testimonio-card img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 12px;
    box-shadow: 0 0 8px rgba(5, 0, 32, 0.1);
  }

  .nombre {
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 5px;
    color: #470db4;
  }

  .grado {
    font-style: italic;
    color: #1e4463; 
    margin-bottom: 10px;
  }

  .cita {
    font-size: 0.95rem;
    color: #1d1d1c; 
    margin-bottom: 10px;
  }
</style>

<!-- Formulario -->
<div class="form-panel animate__animated animate__fadeIn">
  <h2 class="text-center mb-4">Agregar Relatos de Vida Militar</h2>
  <form action="/admin/editor/testimonios/agregar" method="POST" enctype="multipart/form-data">
    <div class="row g-3">
      <div class="col-md-6">
        <label>Nombre</label>
        <input type="text" name="nombre" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label>Grado</label>
        <input type="text" name="grado" class="form-control" required>
      </div>
      <div class="col-md-12">
        <label>Foto</label>
        <input type="file" name="imagen" class="form-control" accept="image/*" required>
      </div>
      <div class="col-12">
        <label>Cita</label>
        <textarea name="cita" rows="3" class="form-control" required></textarea>
      </div>
      <div class="col-12 text-center">
        <button class="btn btn-success px-5 mt-3">Guardar</button>
      </div>
    </div>
  </form>
</div>

<!-- Lista de testimonios -->
<div class="container mt-5">
  <h4 class="text-center mb-4" style="color: #000;">Experiencias en el EjÃ©rcito de Guatemala</h4>
  <div class="row g-4">
    <% if (testimonios && testimonios.length > 0) { %>
      <% testimonios.forEach(t => { %>
        <div class="col-md-4">
          <div class="testimonio-card h-100 animate__animated animate__zoomIn">
            <img src="<%= t.imagen %>" alt="Foto">
            <div class="nombre"><%= t.nombre %></div>
            <div class="grado"><%= t.grado %></div>
            <div class="cita">"<%= t.cita %>"</div>

            <form id="form-eliminar-<%= t.id %>" action="/admin/testimonios/eliminar/<%= t.id %>" method="POST"><form id="form-eliminar-<%= t.id %>" action="/admin/editor/testimonios/eliminar/<%= t.id %>" method="POST"></form>
              <button type="button" class="btn btn-danger btn-sm mt-2" onclick="confirmarEliminacion(<%= t.id %>)">
                Eliminar
              </button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-center text-muted">TodavÃ­a no hay testimonios registrados.</p>
    <% } %>
  </div>
</div>

<!-- SweetAlert2 -->
<script>
  <% if (typeof agregado !== 'undefined' && agregado) { %>
    Swal.fire({
      icon: 'success',
      title: 'Â¡Testimonio guardado!',
      showConfirmButton: false,
      timer: 2000
    });
  <% } else if (typeof eliminado !== 'undefined' && eliminado) { %>
    Swal.fire({
      icon: 'success',
      title: 'Â¡Testimonio eliminado!',
      showConfirmButton: false,
      timer: 2000
    });
  <% } %>

  function confirmarEliminacion(id) {
    Swal.fire({
      title: 'Â¿EstÃ¡s seguro?',
      text: "Este testimonio se eliminarÃ¡ permanentemente.",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'SÃ­, eliminar',
      cancelButtonText: 'Cancelar'
    }).then((result) => {
      if (result.isConfirmed) {
        document.getElementById(`form-eliminar-${id}`).submit();
      }
    });
  }
</script>
