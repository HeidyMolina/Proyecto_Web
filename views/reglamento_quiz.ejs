<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reglamento para el Servicio del Ej√©rcito en Tiempo de Paz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

 <style>
    :root{
      --azul-1:#5ac8fa;
      --azul-2:#4f7cff;
      --verde-1:#00e676;
      --rojo-1:#ff5252;
      --card-bg: linear-gradient(145deg, rgba(255,255,255,.95), rgba(240,248,255,.95));
    
    }
    #enunciado {
  color: #000; /* negro */
}
#rondaScore,
#totalScore {
  color: #000; /* negro */
}
.hero {
  margin-top: 60px; /* üëà baja todo el bloque para que no lo tape el encabezado */

}

.stats .stat {
  color: #0d2c66; /* üëà texto negro */
  font-weight: bold;
}

    
    body {
  margin: 0;
  padding: 0;
  font-family: 'Press Start 2P', cursive;
  background: url('/images-requisitos/entre2.png') no-repeat center center fixed;
  background-size: cover;
}

    .wrap{
      max-width: 980px;
      margin: 40px auto;
      padding: 16px;
    }
    .hero{
      background: linear-gradient(135deg, var(--azul-2), #22d3ee);
      color:#fff;
      border-radius: 28px;
      padding: 28px 22px;
      box-shadow: 0 20px 40px rgba(0,0,0,.15);
      position: relative;
      overflow: hidden;
    }
    .hero:after{
      content:"";
      position:absolute; inset:-40px -60px auto auto;
      width:280px; height:280px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 60%);
      filter: blur(2px);
      animation: orb 6s ease-in-out infinite alternate;
    }
    @keyframes orb{to{transform: translate(-10px,10px) scale(1.06)}}

    .badge-soft{
      display:inline-block; padding:6px 12px; border-radius:999px;
      background:rgba(255,255,255,.18); color:#fff; backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.35); font-weight:800; letter-spacing:.3px;
    }

    .card-quiz {
  background: #6d3b47; /* morado retro */
  border: 4px solid #000;
  border-radius: 12px;
  max-width: 900px;
  margin: 50px auto;
  padding: 40px 20px;
  text-align: center;
  color: #fff;
  box-shadow: 0 0 0 6px #000;
  position: relative;
}

.card-quiz::before {
  content: "‚òÖ";
  font-size: 32px;
  color: gold;
  position: absolute;
  top: -26px;
  left: 50%;
  transform: translateX(-50%);
}
.card-quiz{
      background: var(--card-bg);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      margin-top: 22px;
    }
    .progress{
      height: 18px; border-radius: 12px; background: rgba(0,0,0,.08);
      overflow: hidden;
    }
    .progress-bar{
      background: linear-gradient(90deg, var(--azul-2), var(--azul-1));
      font-weight:800;
    }

    .opciones{
      display:grid; gap:14px;
      grid-template-columns: 1fr; /* one column on mobile */
    }
    @media(min-width:768px){ .opciones{ grid-template-columns: 1fr 1fr; } }

    .opcion, .btn-next, #btnReintentar, #btnMenu {
  background: #00ff4c;
  border: 3px solid #000;
  border-radius: 4px;
  padding: 15px 20px;
  font-family: 'Press Start 2P', cursive;
  color: #000;
  text-transform: uppercase;
  box-shadow: 4px 4px 0 #000;
  transition: transform .2s ease;
}

.opcion:hover, .btn-next:hover {
  transform: translate(-2px, -2px);
  box-shadow: 6px 6px 0 #000;
}

    .opcion.correct{ background: linear-gradient(135deg, #eafff5, #ffffff); box-shadow:0 10px 26px rgba(16,185,129,.35); }
    .opcion.correct .letra{ background: linear-gradient(135deg, #10b981, #22c55e); }
    .opcion.incorrect{ background: linear-gradient(135deg, #fff0f0, #ffffff); box-shadow:0 10px 26px rgba(244,63,94,.25); }
    .opcion.incorrect .letra{ background: linear-gradient(135deg, #ef4444, #f97316); }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px; font-weight:800;
      background:#fff; color:#0f172a; box-shadow: 0 10px 20px rgba(0,0,0,.08);
    }
    .pill .dot{ width:10px; height:10px; border-radius:50%; background: var(--verde-1); }

    .btn-next{
      border:0; border-radius:14px; padding:12px 18px; font-weight:800;
      background: linear-gradient(135deg, var(--azul-2), var(--azul-1));
      color:#fff; box-shadow:0 12px 24px rgba(2,0,84,.25);
    }
    .btn-next:disabled{ opacity:.5; box-shadow:none; }

    .stats{
      display:flex; gap:10px; flex-wrap: wrap;
    }
    .stats .stat{
      background:#fff; border-radius:14px; padding:10px 14px; font-weight:800;
      box-shadow:0 6px 14px rgba(0,0,0,.08);
    }

    .result-card{
      text-align:center; padding:26px 18px;
      background: linear-gradient(145deg, #ffffff, #ecfeff);
      border-radius:24px; box-shadow:0 16px 32px rgba(0,0,0,.12);
    }

    /* Confeti canvas */
    #confettiCanvas{
      position:fixed; inset:0; width:100vw; height:100vh; pointer-events:none; z-index:9999; display:none;
    }
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>

  <div class="wrap">
    <div class="hero mb-4 animate__animated animate__fadeInDown">
  <div class="d-flex justify-content-between align-items-center">
    <span class="badge-soft">MiniJuego</span>
    <div class="stats">
  <div class="stat">‚è±Ô∏è Tiempo: <span id="tiempo">0:00</span></div>
  <div class="stat">‚úîÔ∏è Ronda: <span id="rondaScore">0</span></div>
</div>

  </div>
  <h1 class="mt-3 mb-2 fw-bold">Reglamento para el Servicio del Ej√©rcito en Tiempo de Paz</h1>
  <p class="mb-0">Elige la respuesta correcta. Gana puntos y mejora tu r√©cord. ¬°√Ånimo, soldado! ü´°</p>
</div>


    <div class="card-quiz animate__animated animate__fadeInUp">
  <!-- Progreso -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <div class="pill"><span class="dot"></span> Progreso</div>
    <div class="fw-bold"><span id="nActual">1</span>/<span id="nTotal">10</span></div>
  </div>
  <div class="progress mb-3">
    <div id="barra" class="progress-bar progress-bar-striped progress-bar-animated" style="width:0%">0%</div>
  </div>

  <!-- Pregunta -->
  <h3 id="enunciado" class="mb-3">Cargando‚Ä¶</h3>

  <!-- Opciones -->
  <div id="opciones" class="opciones"></div>

  <!-- Botones principales -->
  <div class="d-flex gap-2 justify-content-end mt-3">
    <button id="btnIniciar" class="btn-next">Iniciar</button>
    <button id="btnSiguiente" class="btn-next" style="display:none">Siguiente</button>
    <button id="btnReintentar" class="btn btn-outline-secondary rounded-3" style="display:none">Reintentar</button>
    <a href="/juegos" class="btn btn-outline-primary rounded-3" id="btnMenu" style="display:none">Men√∫ de Juegos</a>
  </div>
</div>

<!-- üî• Bot√≥n fijo abajo SIEMPRE visible -->
<div class="text-center mt-3">
  <a href="/minigame" class="btn btn-warning rounded-3">Volver a men√∫ Juegos</a>
</div>

<!-- Resultado final -->
<div id="final" class="result-card mt-4 animate__animated animate__fadeIn" style="display:none">
  <h2 class="fw-bold mb-2">¬°Buen trabajo! üéâ</h2>
  <p class="mb-1">Aciertos en esta ronda: <strong><span id="finalRonda">0</span>/<span id="finalTotal">0</span></strong></p>
  <p class="mb-1">Tiempo total: <strong><span id="tiempoFinal">0:00</span></strong> ‚è±Ô∏è</p>
  <div class="d-flex gap-2 justify-content-center">
    <button id="btnOtraVez" class="btn btn-success rounded-3">Jugar otra vez</button>
    <button id="btnReset" class="btn btn-danger rounded-3">Borrar progreso</button>
  </div>
</div>


<script>
// ======= Banco de preguntas (una correcta) =======
const preguntas = [
  {
    q: "¬øQu√© debe aprender un recluta desde su ingreso al Ej√©rcito?",
    a: [
      "Solo a obedecer √≥rdenes b√°sicas.",
      "A vestir correctamente el uniforme, cuidar el arma asignada y obedecer a sus superiores.", // ‚úÖ
      "A realizar ejercicios f√≠sicos sin importar su uniforme."
    ],
    ok: 1,
    ref: "Art√≠culo 15 ‚Äì Instrucci√≥n inicial del recluta",
    detalle: "El recluta debe aprender desde su ingreso a portar correctamente el uniforme, cuidar el arma asignada y obedecer a sus superiores.",
    explicacion: "El uniforme refleja disciplina, el arma responsabilidad y la obediencia mantiene el orden."
  },
  {
    q: "¬øCu√°ndo puede ser nombrado un recluta para servicio de guardia?",
    a: [
      "Cuando termina su instrucci√≥n f√≠sica.",
      "Despu√©s de tres meses de servicio.",
      "Hasta que est√© entrenado en las obligaciones del centinela y manejo de su arma." // ‚úÖ
    ],
    ok: 2,
    ref: "Art√≠culo 16 ‚Äì Servicio de guardia",
    detalle: "El recluta no ser√° nombrado a servicio de guardia sino hasta estar entrenado en las obligaciones del centinela y en el manejo de su arma.",
    explicacion: "El guardia exige dominio del arma y funciones del centinela."
  },
  {
    q: "¬øQu√© tres cualidades representan el verdadero esp√≠ritu del servicio militar?",
    a: [
      "Valor personal, obediencia pronta y exactitud en el servicio.", // ‚úÖ
      "Resistencia f√≠sica, compa√±erismo y obediencia.",
      "Fuerza, disciplina y valor colectivo."
    ],
    ok: 0,
    ref: "Art√≠culo 17 ‚Äì Esp√≠ritu militar",
    detalle: "El verdadero esp√≠ritu militar est√° formado por el valor personal, la obediencia pronta y la exactitud en el servicio.",
    explicacion: "El buen soldado obedece con precisi√≥n y valent√≠a."
  },
  {
    q: "¬øC√≥mo debe dirigirse un soldado a sus superiores inmediatos?",
    a: [
      "Con respeto, obediencia y normas de cortes√≠a estrictas.", // ‚úÖ
      "De forma libre y espont√°nea.",
      "Solo cuando tenga permiso especial."
    ],
    ok: 0,
    ref: "Art√≠culo 18 ‚Äì Trato a superiores",
    detalle: "El soldado debe dirigirse a sus superiores inmediatos con respeto, obediencia y normas estrictas de cortes√≠a.",
    explicacion: "El respeto y la cortes√≠a mantienen la disciplina."
  },
  {
    q: "¬øPor qu√© debe conocer el soldado a los galonistas de su unidad?",
    a: [
      "Para no alegar ignorancia y cumplir la subordinaci√≥n debida.", // ‚úÖ
      "Para saludarlos solamente en formaciones.",
      "Para evitar castigos innecesarios."
    ],
    ok: 0,
    ref: "Art√≠culo 19 ‚Äì Conocimiento de los galonistas",
    detalle: "El soldado debe conocer a los galonistas de su unidad para no alegar ignorancia en el cumplimiento de la subordinaci√≥n.",
    explicacion: "Debe identificar a sus superiores para obedecer correctamente."
  },
  {
    q: "¬øQu√© responsabilidad tiene el soldado sobre su arma y municiones?",
    a: [
      "Guardarlas sin revisarlas hasta que se necesiten.",
      "Mantenerlas limpias, en buen estado y bajo su total cuidado.", // ‚úÖ
      "Prestar el arma a sus compa√±eros de confianza."
    ],
    ok: 1,
    ref: "Art√≠culos 25 y 26 ‚Äì Armas y municiones",
    detalle: "El soldado es responsable de su arma y municiones, debiendo mantenerlas limpias, en buen estado y bajo su cuidado.",
    explicacion: "El arma debe estar siempre lista y bien cuidada."
  },
  {
    q: "¬øQu√© est√° prohibido hacer al soldado con el uniforme?",
    a: [
      "Portar prendas no autorizadas, fumar en formaci√≥n o sentarse en el suelo en p√∫blico.", // ‚úÖ
      "Usar gorra en cualquier forma.",
      "Llevar uniforme solo en actividades deportivas."
    ],
    ok: 0,
    ref: "Art√≠culo 22 ‚Äì Uso del uniforme",
    detalle: "Est√° prohibido al soldado fumar en formaci√≥n, sentarse en el suelo en p√∫blico o portar prendas no autorizadas con el uniforme.",
    explicacion: "El uniforme representa al Ej√©rcito y debe inspirar respeto."
  },
  {
    q: "¬øC√≥mo debe marchar un soldado aunque est√© sin arma?",
    a: [
      "Con porte militar, cuerpo erguido y la cabeza cubierta correctamente.", // ‚úÖ
      "De manera relajada si no est√° armado.",
      "Solo cuidando no correr."
    ],
    ok: 0,
    ref: "Art√≠culo 24 ‚Äì Marcha del soldado",
    detalle: "El soldado debe marchar con porte militar, cuerpo erguido y cabeza cubierta, aun sin portar arma.",
    explicacion: "La marcha refleja orgullo y disciplina militar."
  },
  {
    q: "¬øQu√© debe hacer un soldado al escuchar una se√±al de alarma?",
    a: [
      "Cubrir inmediatamente su sector asignado y esperar instrucciones, incluso hasta las √∫ltimas consecuencias.", // ‚úÖ
      "Reunirse con sus compa√±eros para pedir √≥rdenes.",
      "Buscar refugio personal y esperar que lo llamen."
    ],
    ok: 0,
    ref: "Art√≠culo 32 ‚Äì Se√±ales de alarma",
    detalle: "Al escuchar una se√±al de alarma, el soldado debe cubrir su sector asignado y permanecer a la espera de instrucciones.",
    explicacion: "La alarma exige ocupar el puesto sin demora."
  },
  {
    q: "¬øQu√© sanci√≥n recibe un soldado que se embriaga estando de servicio?",
    a: [
      "Es arrestado inmediatamente y sancionado seg√∫n el reglamento.", // ‚úÖ
      "Recibe solo una llamada de atenci√≥n.",
      "Se le permite descansar hasta recuperarse."
    ],
    ok: 0,
    ref: "Art√≠culo 33 ‚Äì Embriaguez en servicio",
    detalle: "El soldado que se embriague en servicio ser√° arrestado y sancionado conforme al reglamento.",
    explicacion: "La embriaguez pone en riesgo la seguridad y disciplina."
  },
  {
    q: "¬øQu√© debe hacer un soldado si quiere presentar una solicitud o queja?",
    a: [
      "Acudir directamente a un oficial.",
      "Hacerlo primero con su cabo; solo en casos especiales puede acudir a un sargento u oficial.", // ‚úÖ
      "Presentarla en la guardia general."
    ],
    ok: 1,
    ref: "Art√≠culo 34 ‚Äì Solicitudes y quejas",
    detalle: "Las solicitudes o quejas deben presentarse al cabo; solo en casos especiales al sargento u oficial.",
    explicacion: "El reglamento indica seguir la jerarqu√≠a al presentar quejas."
  },
  {
    q: "¬øQu√© debe hacer el soldado cuando entra un oficial a la cuadra?",
    a: [
      "Adoptar la posici√≥n de firmes y dar las novedades a trav√©s del m√°s antiguo.", // ‚úÖ
      "Saludarlo √∫nicamente si lo conoce.",
      "Continuar en sus actividades normales."
    ],
    ok: 0,
    ref: "Art√≠culo 35 ‚Äì Entrada de un oficial a la cuadra",
    detalle: "Al ingresar un oficial a la cuadra, el m√°s antiguo de los presentes debe dar las novedades, y todos adoptar la posici√≥n de firmes.",
    explicacion: "Demuestra respeto y disciplina ante la autoridad."
  },
  {
    q: "¬øQu√© conducta debe mantener un centinela en su puesto?",
    a: [
      "Debe vigilar con toda atenci√≥n, sin conversar, fumar, sentarse ni distraerse.", // ‚úÖ
      "Puede descansar si no hay movimiento.",
      "Solo debe reportar cuando lo releven."
    ],
    ok: 0,
    ref: "Art√≠culo 42 ‚Äì Conducta del centinela",
    detalle: "El centinela no debe conversar, fumar, sentarse, comer ni distraerse, y debe vigilar con atenci√≥n.",
    explicacion: "La vigilancia exige atenci√≥n total para garantizar seguridad."
  },
  {
    q: "¬øQu√© debe hacer un centinela de noche al encontrar a alguien acerc√°ndose?",
    a: [
      "Retarlo con ‚Äú¬°Alto ah√≠! ¬øQui√©n vive?‚Äù, pedir la se√±a y la contrase√±a; si no responde, defender su puesto hasta el sacrificio.", // ‚úÖ
      "Encender su linterna y pedir identificaci√≥n.",
      "Avisar a otro centinela para que investigue."
    ],
    ok: 0,
    ref: "Art√≠culo 52 ‚Äì Retos nocturnos",
    detalle: "El centinela de noche debe retar a los que se acerquen, pedir la se√±a y contrase√±a, y defender su puesto en caso necesario.",
    explicacion: "El reto asegura que solo pase personal autorizado."
  },
  {
    q: "¬øQu√© orden tiene un centinela si tropa armada avanza hacia su puesto sin identificarse?",
    a: [
      "Marcar 'Alto', avisar a su cabo y, si persisten en avanzar, defender el puesto hasta perder la vida.", // ‚úÖ
      "Esconderse y esperar refuerzos.",
      "Dejar que pasen para evitar un enfrentamiento."
    ],
    ok: 0,
    ref: "Art√≠culo 46 ‚Äì Avance de tropa armada",
    detalle: "El centinela debe marcar alto, avisar a su cabo y, si la tropa persiste en avanzar sin identificarse, defender el puesto hasta el sacrificio.",
    explicacion: "Debe impedir cualquier avance no autorizado aunque arriesgue la vida."
  }
];



    // ======= Estado =======
    
    const N = preguntas.length;
    let idx = 0;
    let rondaCorrectas = 0;
    const KEY_TOTAL = 'quiz_reglamento_total_correctas';

    let opcionesActuales = []; // guarda la mezcla de respuestas de la pregunta actual

    // üïí Cron√≥metro
let tiempo = 0;          
let intervaloTiempo = null;

function iniciarCronometro() {
  tiempo = 0;
  if (intervaloTiempo) clearInterval(intervaloTiempo);

  intervaloTiempo = setInterval(() => {
    tiempo++;
    document.getElementById('tiempo').textContent = formatearTiempo(tiempo);
  }, 1000);
}

function detenerCronometro() {
  clearInterval(intervaloTiempo);
}

function formatearTiempo(segundos) {
  const min = Math.floor(segundos / 60);
  const seg = segundos % 60;
  return `${min}:${seg.toString().padStart(2, '0')}`;
}


    // ======= DOM =======
   // ======= DOM =======
const enunciado  = document.getElementById('enunciado');
const contOps    = document.getElementById('opciones');
const barra      = document.getElementById('barra');
const nAct       = document.getElementById('nActual');
const nTot       = document.getElementById('nTotal');
const btnIniciar = document.getElementById('btnIniciar'); // üî• faltaba
const btnSig     = document.getElementById('btnSiguiente');
const btnReint   = document.getElementById('btnReintentar');
const btnMenu    = document.getElementById('btnMenu');
const rondaSpan  = document.getElementById('rondaScore');
const totalSpan  = document.getElementById('totalScore');

const finalBox   = document.getElementById('final');
const finalRonda = document.getElementById('finalRonda');
const finalTotal = document.getElementById('finalTotal');
const btnOtraVez= document.getElementById('btnOtraVez');
const btnReset   = document.getElementById('btnReset');





    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');

    // ======= Util =======
    function getTotal() { return parseInt(localStorage.getItem(KEY_TOTAL) || '0', 10); }
    function setTotal(v) { localStorage.setItem(KEY_TOTAL, String(v)); }

    function pct(){
      const p = Math.round((idx / N) * 100);
      barra.style.width = p + '%';
      barra.textContent = p + '%';
    }

    function resetAcumuladoUI() {
  setTotal(0);
  totalSpan.textContent = '0';
}



function renderPregunta(){
  const p = preguntas[idx];
  enunciado.textContent = p.q;
  contOps.innerHTML = '';
  const letras = ['A','B','C','D','E'];

  // mezclar opciones
  opcionesActuales = p.a.map((texto, i) => ({
    texto,
    esCorrecta: i === p.ok
  }));
  for (let i = opcionesActuales.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [opcionesActuales[i], opcionesActuales[j]] = [opcionesActuales[j], opcionesActuales[i]];
  }

  opcionesActuales.forEach((op, i) => {
    const btn = document.createElement('button');
    btn.className = 'opcion animate__animated animate__fadeIn';
    btn.innerHTML = `
      <div class="letra">${letras[i]}</div>
      <div>${op.texto}</div>
    `;
    btn.addEventListener('click', () => seleccionar(i));
    contOps.appendChild(btn);
  });

  nAct.textContent = idx + 1;
  nTot.textContent = N;
  pct();
  btnSig.disabled = true;
}

// ‚úÖ Nueva funci√≥n
function bloquearOpciones(){
  [...contOps.children].forEach(b => b.disabled = true);
}

// ‚úÖ Aqu√≠ s√≠ va la parte de correcta / incorrecta
function seleccionar(i){
  bloquearOpciones();

  const correcta = opcionesActuales.findIndex(op => op.esCorrecta);

  [...contOps.children].forEach((b, j) => {
    if (j === correcta) {
      b.classList.add('correct','animate__pulse');
    } else {
      b.classList.add('incorrect','animate__shakeX');
    }
  });

  // Contamos punto si eligi√≥ la correcta
  if (i === correcta) {
    rondaCorrectas++;
    guardarProgreso(); 
    // üîä sonido de acierto
    new Audio('/audio/quizcorrecto.mp3').play();
  } else {
    // üîä sonido de error
    new Audio('/audio/quizincorrecto.mp3').play();
  }

  rondaSpan.textContent = rondaCorrectas;
  btnSig.disabled = true; 

  // Esperar 2 segundos antes de mostrar el modal
  setTimeout(() => {
    const ref = preguntas[idx].ref || "Referencia: Entrenamiento f√≠sico";
    const detalle = preguntas[idx].detalle || "Sin detalle disponible";
    const explicacion = preguntas[idx].explicacion || "";

    document.getElementById('refArticulo').textContent = ref;
    document.getElementById('detalleArticulo').textContent = detalle + " " + explicacion;

    const modalEl = document.getElementById('explicacionModal');
    const modal = new bootstrap.Modal(modalEl);
    modal.show();

    modalEl.addEventListener('hidden.bs.modal', () => {
      btnSig.disabled = false;
    }, { once: true });
  }, 1000);
}



function guardarProgreso(){
  localStorage.setItem('quiz_correctas', rondaCorrectas);
  localStorage.setItem('quiz_tiempo', tiempo);
}



function terminar(){
  finalRonda.textContent = rondaCorrectas;
  finalTotal.textContent = N;

  detenerCronometro();
  document.getElementById('tiempoFinal').textContent = formatearTiempo(tiempo);

  // calcular porcentaje de aciertos
  const porcentaje = Math.round((rondaCorrectas / N) * 100);
  let mensajeFinal = "";

  if (porcentaje === 100) {
    mensajeFinal = "¬°Excelente! Has completado todo con disciplina, como un verdadero soldado üëèüéñÔ∏è";
  } else if (porcentaje >= 70) {
    mensajeFinal = "¬°Muy bien! Has demostrado que dominas lo esencial del tema. Ahora desaf√≠ate a ti mismo y alcanza el 100%, como lo hacen los verdaderos soldados que nunca se rinden.";
  } else {
    mensajeFinal = "Lo hiciste bien, pero debes repasar un poco m√°s, repite el juego y sigue practicando üí™, ¬°NO TE RINDAS SOLDADO!";
  }

// ‚úÖ Aqu√≠ guardamos el resultado en la base de datos
fetch('/guardar-resultado', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    juego: "Reglamentos Militares", // üëà cambia al nombre correcto
    puntaje: rondaCorrectas,
    tiempo: tiempo
  })
})
.then(res => res.json())
.then(data => {
  if (data.ok) {
    console.log("Resultado guardado correctamente");
  } else {
    console.log("Error al guardar resultado");
  }
})
.catch(err => console.error("Error en fetch:", err));


  // üßπ limpia mensajes previos antes de agregar el nuevo
  finalBox.querySelectorAll("p.mt-3, img.victoria-img").forEach(el => el.remove());

  // insertar la imagen de victoria antes del mensaje
  const imgVictoria = document.createElement("img");
  imgVictoria.src = "/images-requisitos/victoria1.png";
  imgVictoria.className = "victoria-img mb-3";
  imgVictoria.style.maxWidth = "180px";
  finalBox.appendChild(imgVictoria);

  // insertar el mensaje en el resultado final
  const resultadoExtra = document.createElement("p");
  resultadoExtra.className = "mt-3 fw-bold text-dark";
  resultadoExtra.textContent = mensajeFinal;
  finalBox.appendChild(resultadoExtra);

  // confeti üî•
  lanzarConfeti(140);
  setTimeout(detenerConfeti, 3200);

  // reproducir sonidos de victoria üé∂
  new Audio('/audio/soysoldado.mp3').play();
  new Audio('/audio/victoria.mp3').play();

  document.querySelector('.card-quiz').classList.add('animate__fadeOut');
  setTimeout(() => {
    document.querySelector('.card-quiz').style.display = 'none';
    finalBox.style.display = 'block';
  }, 300);
}



btnIniciar.addEventListener('click', ()=>{
  // reiniciar estado de la ronda
  idx = 0; 
  rondaCorrectas = 0; 
  rondaSpan.textContent = '0';

  // mostrar primera pregunta
  enunciado.textContent = 'Presiona una opci√≥n...';
  contOps.innerHTML = '';
  nTot.textContent = N; 
  nAct.textContent = 0;
  barra.style.width = '0%'; 
  barra.textContent = '0%';

  // ocultar/mostrar botones
  btnIniciar.style.display = 'none';
  btnSig.style.display = 'inline-block';
  btnSig.disabled = true;
  btnReint.style.display = 'none';
  btnMenu.style.display = 'none';

  // iniciar cron√≥metro y preguntas
  iniciarCronometro();
  renderPregunta();
});

btnSig.addEventListener('click', () => {
  if(idx < N-1){
    idx++;
    renderPregunta();
  }else{
    terminar();
    btnSig.style.display = 'none';
    btnReint.style.display = 'inline-block';
    btnMenu.style.display  = 'inline-block';
  }
});

btnReint.addEventListener('click', () => {
  // reiniciar SOLO la ronda actual
  idx = 0; 
  rondaCorrectas = 0;
  rondaSpan.textContent = '0';
  document.querySelector('.card-quiz').style.display = 'block';
  finalBox.style.display = 'none';
  btnSig.style.display = 'inline-block';
  btnSig.disabled = true;
  btnReint.style.display = 'none';
  btnMenu.style.display  = 'none';
  renderPregunta();
});

btnOtraVez.addEventListener('click', () => {
  location.reload(); // üî• recarga toda la p√°gina
});


// üî• Bot√≥n para "Borrar progreso" (tiempo + correctas)
// ‚ö†Ô∏è Aseg√∫rate de tener solo 1 bot√≥n con id="btnReset"
btnReset.addEventListener('click', (e) => {
  e.preventDefault();

  Swal.fire({
    title: '¬øBorrar progreso?',
    text: 'Se reiniciar√° tu tiempo y respuestas correctas.',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: 'S√≠',
    cancelButtonText: 'No',
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#aaa',
    background: '#fff',
    color: '#000',
    width: '480px',
    padding: '1em',
    customClass: { popup: 'animate__animated animate__fadeInDown' }
  }).then((result) => {
    if (result.isConfirmed) {
      // üßπ resetear progreso
      localStorage.removeItem('quiz_tiempo');
      localStorage.removeItem('quiz_correctas');
      tiempo = 0;
      rondaCorrectas = 0;
      document.getElementById('tiempo').textContent = '0:00';
      document.getElementById('tiempoFinal').textContent = '0:00';
      rondaSpan.textContent = '0';
      finalRonda.textContent = '0';

      Swal.fire({
        title: 'Progreso borrado ‚úÖ',
        toast: true,
        position: 'top',
        timer: 1500,
        showConfirmButton: false,
        background: '#fff',
        color: '#000'
      });
    } else if (result.dismiss === Swal.DismissReason.cancel) {
      // üëâ toast de cancelaci√≥n
      Swal.fire({
        title: 'Acci√≥n cancelada ‚ùå',
        toast: true,
        position: 'top',
        timer: 1200,
        showConfirmButton: false,
        background: '#fff',
        color: '#000'
      });
    }
  });
});



    // ======= Confeti simple =======
    let confettis = [], confetiActivo = false;
    function crearConfeti(){
      return {
        x: Math.random() * window.innerWidth,
        y: Math.random() * -50,
        r: Math.random() * 6 + 4,
        d: Math.random() * 100,
        color: `hsl(${Math.random()*360}, 80%, 60%)`,
        tilt: Math.random() * 10 - 5,
        tiltAngle: 0,
        tiltAngleIncrement: Math.random() * 0.07 + 0.05
      };
    }
    function lanzarConfeti(n=120){
      confetiActivo = true;
      confettis = Array.from({length:n}, crearConfeti);
      confettiCanvas.style.display = 'block';
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      requestAnimationFrame(dibujarConfeti);
    }
    
    function dibujarConfeti(){
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confettis.forEach(c=>{
        ctx.beginPath();
        ctx.lineWidth = c.r;
        ctx.strokeStyle = c.color;
        ctx.moveTo(c.x + c.tilt + c.r/2, c.y);
        ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r);
        ctx.stroke();
      });
      confettis.forEach(c=>{
        c.tiltAngle += c.tiltAngleIncrement;
        c.y += Math.cos(0.01 + c.d) + 2;
        c.tilt = Math.sin(c.tiltAngle) * 15;
      });
      if(confetiActivo) requestAnimationFrame(dibujarConfeti);
    }
    function detenerConfeti(){
      confetiActivo = false;
      confettiCanvas.style.display = 'none';
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
    }
    window.addEventListener('resize', ()=>{
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    });

    // ======= Init =======
(function init(){
  nTot.textContent = N;
  rondaSpan.textContent = '0';
  enunciado.textContent = 'Presiona INICIAR para comenzar';
})();


// Reiniciar animaciones al abrir el modal
const modalEl = document.getElementById('explicacionModal');
modalEl.addEventListener('show.bs.modal', () => {
  const img = modalEl.querySelector('img');
  const text = modalEl.querySelector('.animate__fadeInRight');
  
  // Reinicia animaci√≥n de la imagen
  img.classList.remove('animate__fadeInLeft');
  void img.offsetWidth; 
  img.classList.add('animate__fadeInLeft');

  // Reinicia animaci√≥n del texto
  text.classList.remove('animate__fadeInRight');
  void text.offsetWidth;
  text.classList.add('animate__fadeInRight');
});
</script>


<!-- Modal Explicaci√≥n -->
<div class="modal fade" id="explicacionModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Referencia:</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body d-flex align-items-start gap-3">
        <!-- Imagen del soldado con animaci√≥n -->
        <img src="/images/3.png" alt="Soldado explicando" 
             style="width: 80px; height: auto;" 
             class="flex-shrink-0 animate__animated animate__fadeInLeft">

        <!-- Texto de referencia y explicaci√≥n con animaci√≥n -->
        <div class="animate__animated animate__fadeInRight">
          <h6 id="refArticulo" class="fw-bold text-dark"></h6>
          <p id="detalleArticulo" class="text-dark"></p>
        </div>
      </div>

      <!-- Footer del modal con bot√≥n Entendido -->
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal">Entendido</button>
      </div>
    </div>
  </div>
</div>


<!-- Resultado final -->
<div id="final" class="result-card mt-4 animate__animated animate__fadeIn" style="display:none">
  <h2 class="fw-bold mb-2">¬°Buen trabajo! üéâ</h2>
  <p class="mb-1">Aciertos en esta ronda: <strong><span id="finalRonda">0</span>/<span id="finalTotal">0</span></strong></p>
  <p class="mb-1">Tiempo total: <strong><span id="tiempoFinal">0:00</span></strong> ‚è±Ô∏è</p>
  <div class="d-flex gap-2 justify-content-center">
    <button id="btnOtraVez" class="btn btn-success rounded-3">Jugar otra vez</button>
    <button id="btnReset" class="btn btn-danger rounded-3">Borrar progreso</button>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>
